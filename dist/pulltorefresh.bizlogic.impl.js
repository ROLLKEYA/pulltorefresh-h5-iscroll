/**
 * pulltorefresh-h5-iscroll - 一款基于IScroll5的H5下拉刷新实现，包括多种皮肤的实现
 * @version v3.0.0
 * @author 
 */
!function(e,t){function o(e,t,o){var n={type:"V6数据格式"};if(e&&e.ReturnInfo&&"1"==e.ReturnInfo.Code)if(e&&e.BusinessInfo&&"1"==e.BusinessInfo.Code){n.errorType="null";var s="接口请求成功,后台业务逻辑处理成功!";if(e&&e.BusinessInfo&&e.BusinessInfo.Description&&(s=e.BusinessInfo.Description),o.message=s,0===t||"0"===t)o.code=1,o.data=e.UserArea;else if(1===t||"1"===t)if(e&&e.UserArea)if(o.code=1,Array.isArray(e.UserArea))o.data=e.UserArea;else if(e.UserArea.InfoList&&e.UserArea.InfoList[0]&&e.UserArea.InfoList[0].Info){for(var r=[],a=0,i=e.UserArea.InfoList.length;a<i;a++)r.push(e.UserArea.InfoList[a].Info);o.data=r}else{o.data=null;for(var l in e.UserArea)if(Array.isArray(e.UserArea[l])){if(o.data=e.UserArea[l],"InfoList"===l)break}else if("InfoList"===l){e.UserArea[l]&&e.UserArea[l].Info?o.data=e.UserArea[l].Info:o.data=e.UserArea[l];break}}else o.code=0,o.message="接口返回列表数据格式不符合规范!";else if(2===t||"2"===t)if(e&&e.UserArea){o.code=1;var u=0;for(var l in e.UserArea)u++,o.data=e.UserArea[l];u>1&&(o.data=e.UserArea)}else o.code=0,o.message="接口返回详情数据格式不符合规范!";else o.code=0,o.message="处理接口数据错误,传入类别不在处理范围!"}else{n.errorType="2",o.code=0;var s="接口请求错误,后台业务逻辑处理出错!";e&&e.BusinessInfo&&e.BusinessInfo.Description&&(s=e.BusinessInfo.Description),o.message=s}else{n.errorType="1",o.code=0;var s="接口请求错误,后台程序处理出错!";e&&e.ReturnInfo&&e.ReturnInfo.Description&&(s=e.ReturnInfo.Description),o.message=s}return o.status=o.code,o.debugInfo=n,o}function n(e,t,o){var n={type:"V7数据格式"};return o.status=0,e&&e.status?(o.status=e.status.code,o.message=e.status.text,"200"==e.status.code?(o.code=1,1==t?e.custom&&(e.custom.list||e.custom.infoList)?o.data=e.custom.list||e.custom.infoList:(o.code=0,o.message="列表接口返回数据不符合标准规范！"):2==t?e.custom?o.data=e.custom:(o.code=0,o.message="详情接口返回的数据为空！"):o.data=e.custom):o.code=0):(o.code=0,o.message="接口请求错误,缺少status节点!"),o.debugInfo=n,o}e.handleStandardResponse=function(e,t){var s={code:0,message:"",data:null,debugInfo:{type:"未知数据格式"}};return t=t||0,e?(e&&e.ReturnInfo?s=o(e,t,s):e&&e.custom&&e.status?s=n(e,t,s):(s.code=0,s.message="接口数据返回格式不正确,不是V6也不是V7!",s.debugInfo.data=e),s):(s.message="接口返回数据为空!",s)},t.namespace("bizlogic.handleStandardResponse",e.handleStandardResponse)}({},PullToRefreshTools),function(e,t){function o(e){if(null==e||"string"!=typeof e)return null;var t,o=document.createElement("div"),n=document.createDocumentFragment();for(o.innerHTML=e;t=o.firstChild;)n.appendChild(t);return n}function n(e){var t=this,o=e.setting;o.element=document.querySelector(e.pullrefreshSelector),o.down&&(o.down.callback=function(){t.pullDownCallback()}),o.up&&(o.up.callback=function(){t.pullUpCallback()}),t.pullRefreshContainer=o.element,t.respnoseEl=t.pullRefreshContainer.querySelector(e.listSelector),t.options=e,t.setting=o,t.isShouldNoMoreData=!0,t.currPage=t.options.initPageIndex,t.setting.up&&t.setting.up.auto&&t.currPage--,t.initAllEventListeners(),t.pullToRefreshInstance=s.initPullToRefresh(e.setting)}var s,r=t.bizlogic.handleStandardResponse,a="ontouchstart"in document,i=a?"tap":"click",l={isDebug:!1,setting:{down:{height:75,contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新",contentrefreshsuccess:"刷新成功",contentrefresherror:"刷新失败",isSuccessTips:!0},up:{auto:!0,offset:100,show:!0,contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"}},method:"POST",initPageIndex:0,pageSize:10,url:null,template:null,requestData:null,changeData:null,itemClick:null,success:null,error:null,refresh:null,autoRender:!0,itemSelector:"li",listSelector:"#listdata",pullrefreshSelector:"#pullrefresh",delayTime:0,timeOut:6e3,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},contentType:"application/x-www-form-urlencoded",headers:null};n.prototype.pullDownCallback=function(){var e=this;e.loadingDown||(e.isPullDown=!0,e.loadingDown=!0,e.currPage=e.options.initPageIndex,setTimeout(function(){e.ajaxRequest()},e.options.delayTime),e.options.refresh&&e.options.refresh(!0))},n.prototype.pullUpCallback=function(){var e=this;e.loadingUp||(e.isPullDown=!1,e.loadingUp=!0,e.currPage++,setTimeout(function(){e.ajaxRequest()},e.options.delayTime))},n.prototype.initAllEventListeners=function(){var e=this;e.setElemListeners()},n.prototype.setElemListeners=function(){var e=this;e.options.itemClick&&mui(e.options.listSelector).on(i,e.options.itemSelector,e.options.itemClick)},n.prototype.refresh=function(){var e=this;e.setting.up?e.loadingUp||(e.clearResponseEl(),e.currPage=e.options.initPageIndex-1,e.loadingMore()):(e.clearResponseEl(),e.pullDownCallback())},n.prototype.loadingMore=function(e){var t=this;t.loadingMoreSuccess=e,t.pullToRefreshInstance.finished&&(t.pullToRefreshInstance.refresh(!0),t.isShouldNoMoreData=!0),t.pullToRefreshInstance.pullupLoading()},n.prototype.disablePullupToRefresh=function(){this.pullToRefreshInstance.disablePullupToRefresh()},n.prototype.enablePullupToRefresh=function(){this.pullToRefreshInstance.enablePullupToRefresh()},n.prototype.ajaxRequest=function(){var e=this;if(!e.options.url)return e.options.isDebug&&console.error("error***url无效,无法访问"),void e.errorRequest(null,null,"请求url为空!");var t=function(t){var o="";o="function"==typeof e.options.url?e.options.url():e.options.url,mui.ajax(o,{data:t,dataType:"json",timeout:e.options.timeOut,type:e.options.method,accepts:e.options.accepts,headers:e.options.headers,contentType:e.options.contentType,success:function(t){e.successRequest(t)},error:function(t,o){e.errorRequest(t,o,"请求失败!")}})};if(e.options.requestData){var o=e.options.requestData(e.currPage,function(e){t(e)});void 0!==o&&t(o)}else e.options.isDebug&&console.warn("warning***请注意getData不存在,默认数据为空"),t()},n.prototype.errorRequest=function(e,t,o){var n=this;n.isShouldNoMoreData=!1,n.refreshState(!1),n.currPage--,n.currPage=n.currPage>=n.options.initPageIndex?n.currPage:n.options.initPageIndex,n.options.error&&n.options.error(e,t,o)},n.prototype.successRequest=function(e,t){var n=this;if(!e)return n.options.isDebug&&console.log("warning***返回的数据为空,请注意！"),n.isShouldNoMoreData=!1,void n.refreshState(!1);if(n.options.isDebug&&console.log("下拉刷新返回数据:"+JSON.stringify(e)),e=n.options.changeData?n.options.changeData(e):n.defaultChangeResponseData(e),n.options.autoRender){n.isPullDown&&n.clearResponseEl();var s=0;if(window.Mustache)if(e&&Array.isArray(e)&&e.length>0){for(var r="",a=0;a<e.length;a++){var i=e[a],l="";n.options.template&&("string"==typeof n.options.template?l=n.options.template:"function"==typeof n.options.template&&(l=n.options.template(i)));var u=Mustache.render(l,i);r+=u,s++}""!=r&&n.respnoseEl.appendChild(o(r))}else n.isShouldNoMoreData=!1;else n.isShouldNoMoreData=!1,1==n.options.isDebug&&console.error("error***没有包含mustache.min.js,无法进行模板渲染")}n.options.success&&"function"==typeof n.options.success&&n.options.success(e,n.isPullDown||n.currPage==n.options.initPageIndex),t||n.refreshState(!0,s)},n.prototype.defaultChangeResponseData=function(e){var t=r(e,1);return t.data},n.prototype.refreshState=function(e,t){var o=this;t=t||0,o.pullToRefreshInstance.setSuccessTips&&o.pullToRefreshInstance.setSuccessTips("更新"+t+"条数据"),o.isPullDown&&(o.pullToRefreshInstance.endPullDownToRefresh(e),o.pullToRefreshInstance.finished&&(o.pullToRefreshInstance.refresh(!0),o.isShouldNoMoreData=!0)),o.isShouldNoMoreData?o.pullToRefreshInstance.endPullUpToRefresh(!1,e):o.pullToRefreshInstance.endPullUpToRefresh(!0,e),o.loadingDown=!1,o.loadingUp=!1},n.prototype.clearResponseEl=function(){var e=this;e.options.autoRender&&e.respnoseEl&&(e.respnoseEl.innerHTML="")},e.initPullDownRefresh=function(e,o){e=e||{};var r=document.querySelector(e.listSelector||"#listdata"),a=e.template,i=r.getAttribute("data-tpl")||"#item-template";"string"!=typeof a||"."!=a.charAt(0)&&"#"!=a.charAt(0)||(i=a,e.template="");var u=document.querySelector(i);if(u&&(e.template=e.template||u.innerHTML.toString()||""),e=t.extend(!0,{},l,e),s=e.targetPullToRefresh||e.skin||PullToRefreshTools.skin.defaults,!s)return void console.error("错误:传入的下拉刷新皮肤错误,超出范围!");var c=new n(e);return o&&o(c),c},"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&(define.amd||define.cmd)&&define(function(){return e}),t.namespace("bizlogic.initPullDownRefresh",e.initPullDownRefresh),t.namespace("bizlogic.init",e.initPullDownRefresh)}({},PullToRefreshTools);